<?xml version="1.0" encoding="UTF-8"?>
<message_set>
  <message>
    <name>LAMSS_CONTACT</name>
    <id>23</id>
    <trigger>publish</trigger>
    <trigger_moos_var>CONTACT_REPORT</trigger_moos_var>
    <size>32</size>
    <header>
      <time>
        <name>time</name>
      </time>
      <src_id>
        <name>node</name>
        <moos_var>VEHICLE_ID</moos_var>
      </src_id>
    </header>
    <layout>
      <static>
        <name>MessageType</name>
        <value>LAMSS_CONTACT</value>
      </static>
      <float>
        <name>Nav_x</name>
        <moos_var>NAV_X</moos_var>
        <max>100000</max>
        <min>-100000</min>
        <precision>0</precision>
      </float>
      <float>
        <name>Nav_y</name>
        <moos_var>NAV_Y</moos_var>
        <max>100000</max>
        <min>-100000</min>
        <precision>0</precision>
      </float>
      <float algorithm="angle_0_360">
        <moos_var>NAV_HEADING</moos_var>
        <name>Heading</name>
        <max>359</max>
        <min>0</min>
        <precision>0</precision>
      </float>
      <float>
        <name>Speed</name>
        <moos_var>NAV_SPEED</moos_var>
        <max>6</max>
        <min>0</min>
        <precision>1</precision>
      </float>
      <float>
        <name>Depth</name>
        <moos_var>NAV_DEPTH</moos_var>
        <max>6400</max>
        <min>0</min>
        <precision>1</precision>
      </float>
      <!-- for active collaboration -->
      <enum>
        <name>collaboration_mode</name>
        <moos_var>COLLABORATION_MODE</moos_var>
        <value>OFF</value>
        <value>SYNCH</value>
        <value>COLLABORATING</value>
      </enum>      
      <enum>
        <name>sonar_control</name>
        <moos_var>SONAR_CONTROL</moos_var>
        <value>ON</value>
        <value>OFF</value>
      </enum>
    <!-- Track 1 -->
      <int>
        <name>track</name>
        <max>8191</max>
        <min>0</min>
      </int>
      <int>
        <name>priority</name>
        <max>15</max>
        <min>0</min>
      </int>
      <int>
        <name>template</name>
        <max>7</max>
        <min>0</min>
      </int>
      <float>
        <name>ael_x</name>
        <max>100000</max>
        <min>-100000</min>
        <precision>0</precision>
      </float>
      <float>
        <name>ael_y</name>
        <max>100000</max>
        <min>-100000</min>
        <precision>0</precision>
      </float>
      <float algorithm="angle_0_360">
        <name>bearing</name>
        <max>359</max>
        <min>0</min>
        <precision>1</precision>
      </float>
      <float>
        <name>bearing_error</name>
        <max>31</max>
        <min>0</min>
        <precision>1</precision>
      </float>
      <float>
        <name>rate</name>
        <max>10</max>
        <min>-10</min>
        <precision>2</precision>
      </float>
      <float>
        <name>rate_error</name>
        <max>7</max>
        <min>0</min>
        <precision>2</precision>
      </float>
      <float>
        <name>snr</name>
        <max>50</max>
        <min>-50</min>
        <precision>2</precision>
      </float>
    </layout>
    <!-- decoding -->
    <on_receipt>
      <publish>
        <moos_var>CONTACT_REPORT_IN</moos_var>
        <all />
      </publish>
      <!-- LAMSS contact report. Standard for iMOOS2SQL -->       
      <publish>
        <moos_var>CONTACT_MESSAGE</moos_var>
        <format>utm_y2lat:xp(yp)=%14%,utm_x2lon:yp(xp)=%15%,MessageType=LAMSS_CONTACT,node=%1%,track=%2%,state=2,xp=%3%,yp=%4%,nav_hdg=%5%,nav_dep=%6%,nav_spd=%7%,bearing=%8%,sigma=%9%,rate=%10%,rate_sigma=%11%,snr=%12%,time=%13$.0lf,nfeat=0</format>
        <message_var>node</message_var>
        <message_var>track</message_var>
        <message_var>Nav_x</message_var>
        <message_var>Nav_y</message_var>
        <message_var>Heading</message_var>
        <message_var>Depth</message_var>
        <message_var>Speed</message_var>
        <message_var>bearing</message_var>
        <message_var>bearing_error</message_var>
        <message_var>rate</message_var>
        <message_var>rate_error</message_var>
        <message_var>snr</message_var>
        <message_var>time</message_var>
        <message_var algorithm="utm_y2lat:Nav_x">Nav_y</message_var>
        <message_var algorithm="utm_x2lon:Nav_y">Nav_x</message_var>
      </publish>
      <!-- Bearing line for pMarineViewer. -->       
      <publish>
        <moos_var>BEARING_LINE</moos_var>
        <format>vname=%1%,bearing=%2%,range=500,time_limit=180,vector_color=red,vector_width=2,</format>
        <message_var algorithm="modem_id2name,to_lower">node</message_var>
        <message_var>bearing</message_var>
      </publish>
      <!-- start pTransponderNODE replacement -->    
      <publish>
        <moos_var>NODE_REPORT</moos_var>
        <format>NAME=%1%,TYPE=%2%,UTC_TIME=%3$.0lf,X=%4%,Y=%5%,LAT=%6$lf,LON=%7$lf,SPD=%8%,HDG=%9%,DEPTH=%10%</format>
        <message_var algorithm="modem_id2name,to_lower">node</message_var>
        <message_var algorithm="modem_id2type,to_lower">node</message_var>
        <message_var>time</message_var>
        <message_var>Nav_x</message_var>
        <message_var>Nav_y</message_var>
        <message_var algorithm="utm_y2lat:Nav_x">Nav_y</message_var>
        <message_var algorithm="utm_x2lon:Nav_y">Nav_x</message_var>
        <message_var>Speed</message_var>
        <message_var>Heading</message_var>
        <message_var>Depth</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_UTC</moos_var>
        <format>%2$lf</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>time</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_X</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>Nav_x</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_Y</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>Nav_y</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_LAT</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var algorithm="utm_y2lat:Nav_x">Nav_y</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_LONG</moos_var>
        <format>%2$lf</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var algorithm="utm_x2lon:Nav_y">Nav_x</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_SPEED</moos_var>
        <format>%2$lf</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>Speed</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_HEADING</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>Heading</message_var>
      </publish>
      <publish>
        <moos_var type="double">%1%_NAV_DEPTH</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>Depth</message_var>
      </publish>
      <publish>
        <moos_var>%1%_BEARING_TRACKS</moos_var>
	<format>track=%2%,priority=%3%,template=%4%,state=2,ips=0,ael_x=%5%,ael_y=%6%,bearing=%7%,sigma=%8%,rate=%9%,rate_sigma=%10%,snr=%11%,time=%12$.01f,nfeat=0</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>track</message_var>
        <message_var>priority</message_var>
        <message_var>template</message_var>
        <message_var>ael_x</message_var>
        <message_var>ael_y</message_var>
        <message_var>bearing</message_var>
        <message_var>bearing_error</message_var>
        <message_var>rate</message_var>
        <message_var>rate_error</message_var>
        <message_var>snr</message_var>
        <message_var>time</message_var>
      </publish>
      <publish>
        <moos_var>%1%_COLLABORATION</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>collaboration_mode</message_var>
      </publish>
      <publish>
        <moos_var>%1%_SONAR_CONTROL</moos_var>
        <format>%2%</format>
        <message_var algorithm="modem_id2name,to_upper">node</message_var>
        <message_var>sonar_control</message_var>
      </publish>
    </on_receipt>
    <queuing>
      <ack>false</ack>
      <blackout_time>30</blackout_time>
      <max_queue>1</max_queue>
      <newest_first>true</newest_first>
      <ttl>600</ttl>
      <value_base>2</value_base>
    </queuing>
  </message>
</message_set>
